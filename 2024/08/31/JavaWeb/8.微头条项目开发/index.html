

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="glasss">
  <meta name="keywords" content="">
  
    <meta name="description" content="第七章 前端工程化第八章 微头条项目开发一 项目简介1.1 微头条业务简介 微头条新闻发布和浏览平台,主要包含业务如下   用户功能 注册功能 登录功能   头条新闻 新闻的分页浏览 通过标题关键字搜索新闻 查看新闻详情 新闻的修改和删除   权限控制 用户只能修改和自己发布的头条新闻    1.2 技术栈介绍 前端技术栈   ES6作为基础JS语法 nodejs用于运行环境 npm用于项目依赖管">
<meta property="og:type" content="article">
<meta property="og:title" content="微头条项目开发">
<meta property="og:url" content="https://glassless.github.io/2024/08/31/JavaWeb/8.%E5%BE%AE%E5%A4%B4%E6%9D%A1%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="Glass的博客">
<meta property="og:description" content="第七章 前端工程化第八章 微头条项目开发一 项目简介1.1 微头条业务简介 微头条新闻发布和浏览平台,主要包含业务如下   用户功能 注册功能 登录功能   头条新闻 新闻的分页浏览 通过标题关键字搜索新闻 查看新闻详情 新闻的修改和删除   权限控制 用户只能修改和自己发布的头条新闻    1.2 技术栈介绍 前端技术栈   ES6作为基础JS语法 nodejs用于运行环境 npm用于项目依赖管">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511893.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511819.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511847.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511873.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511926.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511966.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511884.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511953.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511218.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511286.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511796.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511891.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511206.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511246.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511064.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511264.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511366.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511495.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511838.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511850.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511054.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511223.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511770.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511377.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511607.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511678.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512824.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512896.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512280.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512364.gif">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512575.gif">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512784.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512659.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512134.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512280.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511926.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511966.png">
<meta property="og:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511884.png">
<meta property="article:published_time" content="2024-08-31T07:12:56.000Z">
<meta property="article:modified_time" content="2024-09-02T06:10:28.148Z">
<meta property="article:author" content="glasss">
<meta property="article:tag" content="java web">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511893.png">
  
  
  
  <title>微头条项目开发 - Glass的博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"glassless.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"Java"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Glass</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="微头条项目开发"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-08-31 15:12" pubdate>
          2024年8月31日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          89 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">微头条项目开发</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="第七章-前端工程化"><a href="#第七章-前端工程化" class="headerlink" title="第七章 前端工程化"></a>第七章 前端工程化</h1><h1 id="第八章-微头条项目开发"><a href="#第八章-微头条项目开发" class="headerlink" title="第八章 微头条项目开发"></a>第八章 微头条项目开发</h1><h1 id="一-项目简介"><a href="#一-项目简介" class="headerlink" title="一 项目简介"></a>一 项目简介</h1><h2 id="1-1-微头条业务简介"><a href="#1-1-微头条业务简介" class="headerlink" title="1.1 微头条业务简介"></a>1.1 微头条业务简介</h2><blockquote>
<p>微头条新闻发布和浏览平台,主要包含业务如下</p>
</blockquote>
<ul>
<li>用户功能<ul>
<li>注册功能</li>
<li>登录功能</li>
</ul>
</li>
<li>头条新闻<ul>
<li>新闻的分页浏览</li>
<li>通过标题关键字搜索新闻</li>
<li>查看新闻详情</li>
<li>新闻的修改和删除</li>
</ul>
</li>
<li>权限控制<ul>
<li>用户只能修改和自己发布的头条新闻</li>
</ul>
</li>
</ul>
<h2 id="1-2-技术栈介绍"><a href="#1-2-技术栈介绍" class="headerlink" title="1.2 技术栈介绍"></a>1.2 技术栈介绍</h2><blockquote>
<p>前端技术栈</p>
</blockquote>
<ul>
<li>ES6作为基础JS语法</li>
<li>nodejs用于运行环境</li>
<li>npm用于项目依赖管理工具</li>
<li>vite用于项目的构建架工具</li>
<li>Vue3用于项目数据的渲染框架</li>
<li>Axios用于前后端数据的交互</li>
<li>Router用于页面的跳转</li>
<li>Pinia用于存储用户的数据</li>
<li>LocalStorage作为用户校验token的存储手段</li>
<li>Element-Plus提供组件</li>
</ul>
<blockquote>
<p>后端技术栈</p>
</blockquote>
<ul>
<li>JAVA作为开发语言,版本为JDK17</li>
<li>Tomcat作为服务容器,版本为10.1.7</li>
<li>Mysql8用于项目存储数据</li>
<li>Servlet用于控制层实现前后端数据交互</li>
<li>JDBC用于实现数据的CURD</li>
<li>Druid用于提供数据源的连接池</li>
<li>MD5用于用户密码的加密</li>
<li>Jwt用于token的生成和校验</li>
<li>Jackson用于转换JSON</li>
<li>Filter用于用户登录校验和跨域处理</li>
<li>Lombok用于处理实体类</li>
</ul>
<h2 id="1-3-功能展示"><a href="#1-3-功能展示" class="headerlink" title="1.3 功能展示"></a>1.3 功能展示</h2><blockquote>
<p>头条首页信息搜索</p>
</blockquote>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511893.png" srcset="/img/loading.gif" lazyload alt="1687657562841"></p>
<blockquote>
<p>登录功能</p>
</blockquote>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511819.png" srcset="/img/loading.gif" lazyload alt="1683883374643"></p>
<blockquote>
<p>注册功能</p>
</blockquote>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511847.png" srcset="/img/loading.gif" lazyload alt="1683883394612"></p>
<blockquote>
<p>权限控制功能</p>
</blockquote>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511873.png" srcset="/img/loading.gif" lazyload alt="1687657603246"></p>
<blockquote>
<p>发布头条功能</p>
</blockquote>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511926.png" srcset="/img/loading.gif" lazyload alt="1683883660552"></p>
<blockquote>
<p>修改头条功能</p>
</blockquote>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511966.png" srcset="/img/loading.gif" lazyload alt="1683883695289"></p>
<blockquote>
<p>删除头条功能</p>
</blockquote>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511884.png" srcset="/img/loading.gif" lazyload alt="1683883724768"></p>
<h1 id="二-前端项目环境搭建"><a href="#二-前端项目环境搭建" class="headerlink" title="二 前端项目环境搭建"></a>二 前端项目环境搭建</h1><ul>
<li>解压前端项目代码并存放到磁盘的合适位置</li>
</ul>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511953.png" srcset="/img/loading.gif" lazyload alt="1683882754527"></p>
<ul>
<li>使用vscode打开工程</li>
</ul>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511218.png" srcset="/img/loading.gif" lazyload alt="1683882823511"></p>
<ul>
<li>进入项目后打开集成终端或者在src上右击选择在集成终端中打开</li>
</ul>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511286.png" srcset="/img/loading.gif" lazyload alt="1683882921502"></p>
<ul>
<li>通过 npm run dev启动前端项目</li>
</ul>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511796.png" srcset="/img/loading.gif" lazyload alt="1683883090728"></p>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511891.png" srcset="/img/loading.gif" lazyload alt="1683883112782"></p>
<h1 id="三-后端项目环境搭建"><a href="#三-后端项目环境搭建" class="headerlink" title="三 后端项目环境搭建"></a>三 后端项目环境搭建</h1><h2 id="3-1-数据库准备"><a href="#3-1-数据库准备" class="headerlink" title="3.1  数据库准备"></a>3.1  数据库准备</h2><blockquote>
<p><code>news_users</code> 用户表</p>
</blockquote>
<img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511206.png" srcset="/img/loading.gif" lazyload alt="1683188408798"  />

<blockquote>
<p><code>news_type</code> 新闻类型表</p>
</blockquote>
<img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511246.png" srcset="/img/loading.gif" lazyload alt="1683188444555"  />

<blockquote>
<p><code>news_headline</code> 新闻信息表</p>
</blockquote>
<img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511064.png" srcset="/img/loading.gif" lazyload alt="1683188471933"  />

<blockquote>
<p>数据库创建SQL</p>
</blockquote>
<ul>
<li>导入资料中的top_news.sql文件即可</li>
</ul>
<h2 id="3-2-MVC项目架构模式"><a href="#3-2-MVC项目架构模式" class="headerlink" title="3.2 MVC项目架构模式"></a>3.2 MVC项目架构模式</h2><blockquote>
<p> MVC（Model View Controller）是软件工程中的一种**<code>软件架构模式</code><strong>，它把软件系统分为</strong><code>模型</code><strong>、</strong><code>视图</code><strong>和</strong><code>控制器</code>**三个基本部分。用一种业务逻辑、数据、界面显示分离的方法组织代码，将业务逻辑聚集到一个部件里面，在改进和个性化定制界面及用户交互的同时，不需要重新编写业务逻辑。</p>
</blockquote>
<ul>
<li><p><strong>M</strong>：Model 模型层,具体功能如下</p>
<ol>
<li>存放和数据库对象的实体类以及一些用于存储非数据库表完整相关的VO对象</li>
<li>存放一些对数据进行逻辑运算操作的的一些业务处理代码</li>
</ol>
</li>
<li><p><strong>V</strong>：View 视图层,具体功能如下</p>
<ol>
<li>存放一些视图文件相关的代码 html css js等</li>
<li>在前后端分离的项目中,后端已经没有视图文件,该层次已经衍化成独立的前端项目</li>
</ol>
</li>
<li><p><strong>C</strong>：Controller 控制层,具体功能如下<br>1. 接收客户端请求,获得请求数据<br>2. 将准备好的数据响应给客户端</p>
</li>
</ul>
<blockquote>
<p>MVC模式下,项目中的常见包</p>
</blockquote>
<ul>
<li><p>M:</p>
<ol>
<li>实体类包(pojo &#x2F;entity &#x2F;bean) 专门存放和数据库对应的实体类和一些VO对象</li>
<li>数据库访问包(dao&#x2F;mapper)  专门存放对数据库不同表格CURD方法封装的一些类</li>
<li>服务包(service)                       专门存放对数据进行业务逻辑预算的一些类</li>
</ol>
</li>
<li><p>C:</p>
<ol>
<li>控制层包(controller)</li>
</ol>
</li>
<li><p>V:</p>
<ol>
<li>web目录下的视图资源 html css js img 等</li>
<li>前端工程化后,在后端项目中已经不存在了</li>
</ol>
</li>
</ul>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511264.png" srcset="/img/loading.gif" lazyload alt="1683363039636"></p>
<h2 id="3-3-搭建项目"><a href="#3-3-搭建项目" class="headerlink" title="3.3 搭建项目"></a>3.3 搭建项目</h2><h3 id="3-3-1-创建WEB项目"><a href="#3-3-1-创建WEB项目" class="headerlink" title="3.3.1 创建WEB项目"></a>3.3.1 创建WEB项目</h3><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511366.png" srcset="/img/loading.gif" lazyload alt="1683350231551"></p>
<h3 id="3-3-2-导入依赖"><a href="#3-3-2-导入依赖" class="headerlink" title="3.3.2 导入依赖"></a>3.3.2 导入依赖</h3><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511495.png" srcset="/img/loading.gif" lazyload alt="1683351095131"></p>
<h3 id="3-3-3-准备包结构"><a href="#3-3-3-准备包结构" class="headerlink" title="3.3.3 准备包结构"></a>3.3.3 准备包结构</h3><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511838.png" srcset="/img/loading.gif" lazyload alt="1683350275719"></p>
<ul>
<li>controller 控制层代码,主要由Servlet组成</li>
<li>service     服务层代码,主要用于处理业务逻辑</li>
<li>dao          数据访问层,主要用户定义对于各个表格的CURD的方法</li>
<li>pojo         实体类层,主要用于存放和数据库对应的实体类以及一些VO对象</li>
<li>util           工具类包,主要用存放一些工具类</li>
<li>common  公共包,主要用户存放一些其他公共代码</li>
<li>filters       过滤器包,专门用于存放一些过滤器</li>
<li>test          测试代码包,专门用于定义一些测试的功能代码,上线前应该删掉,后期用maven可以自动处理掉</li>
</ul>
<h2 id="3-5-准备工具类"><a href="#3-5-准备工具类" class="headerlink" title="3.5 准备工具类"></a>3.5 准备工具类</h2><h3 id="3-5-1-异步响应规范格式类"><a href="#3-5-1-异步响应规范格式类" class="headerlink" title="3.5.1 异步响应规范格式类"></a>3.5.1 异步响应规范格式类</h3><ul>
<li>Result类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.common;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 全局统一返回结果类</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span>&lt;T&gt; &#123;<br>    <span class="hljs-comment">// 返回码</span><br>    <span class="hljs-keyword">private</span> Integer code;<br>    <span class="hljs-comment">// 返回消息</span><br>    <span class="hljs-keyword">private</span> String message;<br>    <span class="hljs-comment">// 返回数据</span><br>    <span class="hljs-keyword">private</span> T data;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Result</span><span class="hljs-params">()</span>&#123;&#125;<br>    <span class="hljs-comment">// 返回数据</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">build</span><span class="hljs-params">(T data)</span> &#123;<br>        Result&lt;T&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;T&gt;();<br>        <span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span>)<br>            result.setData(data);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">build</span><span class="hljs-params">(T body, Integer code, String message)</span> &#123;<br>        Result&lt;T&gt; result = build(body);<br>        result.setCode(code);<br>        result.setMessage(message);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">build</span><span class="hljs-params">(T body, ResultCodeEnum resultCodeEnum)</span> &#123;<br>        Result&lt;T&gt; result = build(body);<br>        result.setCode(resultCodeEnum.getCode());<br>        result.setMessage(resultCodeEnum.getMessage());<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 操作成功</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data  baseCategory1List</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>&lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">ok</span><span class="hljs-params">(T data)</span>&#123;<br>        Result&lt;T&gt; result = build(data);<br>        <span class="hljs-keyword">return</span> build(data, ResultCodeEnum.SUCCESS);<br>    &#125;<br>    <span class="hljs-keyword">public</span> Result&lt;T&gt; <span class="hljs-title function_">message</span><span class="hljs-params">(String msg)</span>&#123;<br>        <span class="hljs-built_in">this</span>.setMessage(msg);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> Result&lt;T&gt; <span class="hljs-title function_">code</span><span class="hljs-params">(Integer code)</span>&#123;<br>        <span class="hljs-built_in">this</span>.setCode(code);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCode</span><span class="hljs-params">(Integer code)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> message;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMessage</span><span class="hljs-params">(String message)</span> &#123;<br>        <span class="hljs-built_in">this</span>.message = message;<br>    &#125;<br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getData</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> data;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(T data)</span> &#123;<br>        <span class="hljs-built_in">this</span>.data = data;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ResultCodeEnum 枚举类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.common;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 统一返回结果状态信息类</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ResultCodeEnum</span> &#123;<br><br>    SUCCESS(<span class="hljs-number">200</span>,<span class="hljs-string">&quot;success&quot;</span>),<br>    USERNAME_ERROR(<span class="hljs-number">501</span>,<span class="hljs-string">&quot;usernameError&quot;</span>),<br>    PASSWORD_ERROR(<span class="hljs-number">503</span>,<span class="hljs-string">&quot;passwordError&quot;</span>),<br>    NOTLOGIN(<span class="hljs-number">504</span>,<span class="hljs-string">&quot;notLogin&quot;</span>),<br>    USERNAME_USED(<span class="hljs-number">505</span>,<span class="hljs-string">&quot;userNameUsed&quot;</span>)<br>    ;<br><br>    <span class="hljs-keyword">private</span> Integer code;<br>    <span class="hljs-keyword">private</span> String message;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ResultCodeEnum</span><span class="hljs-params">(Integer code, String message)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.message = message;<br>    &#125;<br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> message;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>



<h3 id="3-5-2-MD5加密工具类"><a href="#3-5-2-MD5加密工具类" class="headerlink" title="3.5.2 MD5加密工具类"></a>3.5.2 MD5加密工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.util;<br><br><span class="hljs-keyword">import</span> java.security.MessageDigest;<br><span class="hljs-keyword">import</span> java.security.NoSuchAlgorithmException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MD5Util</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String strSrc)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">char</span> hexChars[] = &#123; <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>,<br>                    <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span> &#125;;<br>            <span class="hljs-type">byte</span>[] bytes = strSrc.getBytes();<br>            <span class="hljs-type">MessageDigest</span> <span class="hljs-variable">md</span> <span class="hljs-operator">=</span> MessageDigest.getInstance(<span class="hljs-string">&quot;MD5&quot;</span>);<br>            md.update(bytes);<br>            bytes = md.digest();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> bytes.length;<br>            <span class="hljs-type">char</span>[] chars = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[j * <span class="hljs-number">2</span>];<br>            <span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; bytes.length; i++) &#123;<br>                <span class="hljs-type">byte</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> bytes[i];<br>                chars[k++] = hexChars[b &gt;&gt;&gt; <span class="hljs-number">4</span> &amp; <span class="hljs-number">0xf</span>];<br>                chars[k++] = hexChars[b &amp; <span class="hljs-number">0xf</span>];<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(chars);<br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchAlgorithmException e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;MD5加密出错！！+&quot;</span> + e);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="3-5-3-JDBCUtil连接池工具类"><a href="#3-5-3-JDBCUtil连接池工具类" class="headerlink" title="3.5.3 JDBCUtil连接池工具类"></a>3.5.3 JDBCUtil连接池工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.util;<br><br><span class="hljs-keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;<br><br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><span class="hljs-keyword">import</span> java.util.Properties;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JDBCUtil</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Connection&gt; threadLocal =<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> DataSource dataSource;<br>    <span class="hljs-comment">// 初始化连接池</span><br>    <span class="hljs-keyword">static</span>&#123;<br>        <span class="hljs-comment">// 可以帮助我们读取.properties配置文件</span><br>        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">resourceAsStream</span> <span class="hljs-operator">=</span> JDBCUtil.class.getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;jdbc.properties&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            properties.load(resourceAsStream);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            dataSource = DruidDataSourceFactory.createDataSource(properties);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br><br><br>    &#125;<br>    <span class="hljs-comment">/*1 向外提供连接池的方法*/</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DataSource <span class="hljs-title function_">getDataSource</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> dataSource;<br>    &#125;<br><br>    <span class="hljs-comment">/*2 向外提供连接的方法*/</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> threadLocal.get();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == connection) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                connection = dataSource.getConnection();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>            threadLocal.set(connection);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> connection;<br>    &#125;<br><br><br>    <span class="hljs-comment">/*定义一个归还连接的方法 (解除和ThreadLocal之间的关联关系) */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseConnection</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> threadLocal.get();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != connection) &#123;<br>            threadLocal.remove();<br>            <span class="hljs-comment">// 把连接设置回自动提交的连接</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                connection.setAutoCommit(<span class="hljs-literal">true</span>);<br>                <span class="hljs-comment">// 自动归还到连接池</span><br>                connection.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ul>
<li>添加jdbc.properties配置文件</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">driverClassName</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/top_news</span><br><span class="hljs-attr">username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">password</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">initialSize</span>=<span class="hljs-string">5</span><br><span class="hljs-attr">maxActive</span>=<span class="hljs-string">10</span><br><span class="hljs-attr">maxWait</span>=<span class="hljs-string">1000</span><br></code></pre></td></tr></table></figure>

<h3 id="3-5-4-JwtHelper工具类"><a href="#3-5-4-JwtHelper工具类" class="headerlink" title="3.5.4  JwtHelper工具类"></a>3.5.4  JwtHelper工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.util;<br><br><span class="hljs-keyword">import</span> com.alibaba.druid.util.StringUtils;<br><span class="hljs-keyword">import</span> io.jsonwebtoken.*;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtHelper</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">tokenExpiration</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>*<span class="hljs-number">1000</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">tokenSignKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span>;<br><br>    <span class="hljs-comment">//生成token字符串</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">createToken</span><span class="hljs-params">(Long userId)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> Jwts.builder()<br><br>                .setSubject(<span class="hljs-string">&quot;YYGH-USER&quot;</span>)<br>                .setExpiration(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis() + tokenExpiration))<br>                .claim(<span class="hljs-string">&quot;userId&quot;</span>, userId)<br>                .signWith(SignatureAlgorithm.HS512, tokenSignKey)<br>                .compressWith(CompressionCodecs.GZIP)<br>                .compact();<br>        <span class="hljs-keyword">return</span> token;<br>    &#125;<br><br>    <span class="hljs-comment">//从token字符串获取userid</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Long <span class="hljs-title function_">getUserId</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(token)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(tokenSignKey).parseClaimsJws(token);<br>        <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> claimsJws.getBody();<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Integer)claims.get(<span class="hljs-string">&quot;userId&quot;</span>);<br>        <span class="hljs-keyword">return</span> userId.longValue();<br>    &#125;<br><br><br><br>    <span class="hljs-comment">//判断token是否有效</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isExpiration</span><span class="hljs-params">(String token)</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isExpire</span> <span class="hljs-operator">=</span> Jwts.parser()<br>                    .setSigningKey(tokenSignKey)<br>                    .parseClaimsJws(token)<br>                    .getBody()<br>                    .getExpiration().before(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            <span class="hljs-comment">//没有过期，有效，返回false</span><br>            <span class="hljs-keyword">return</span> isExpire;<br>        &#125;<span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            <span class="hljs-comment">//过期出现异常，返回true</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="3-5-5-JSON转换的WEBUtil工具类"><a href="#3-5-5-JSON转换的WEBUtil工具类" class="headerlink" title="3.5.5 JSON转换的WEBUtil工具类"></a>3.5.5 JSON转换的WEBUtil工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.util;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.text.SimpleDateFormat;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebUtil</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ObjectMapper objectMapper;<br>    <span class="hljs-comment">// 初始化objectMapper</span><br>    <span class="hljs-keyword">static</span>&#123;<br>        objectMapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>        <span class="hljs-comment">// 设置JSON和Object转换时的时间日期格式</span><br>        objectMapper.setDateFormat(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));<br>    &#125;<br>	<span class="hljs-comment">// 从请求中获取JSON串并转换为Object</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">readJson</span><span class="hljs-params">(HttpServletRequest request,Class&lt;T&gt; clazz)</span>&#123;<br>        <span class="hljs-type">T</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span><span class="hljs-literal">null</span>;<br>        <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            reader = request.getReader();<br>            <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">line</span> <span class="hljs-operator">=</span><span class="hljs-literal">null</span>;<br>            <span class="hljs-keyword">while</span>((line = reader.readLine())!= <span class="hljs-literal">null</span>)&#123;<br>                buffer.append(line);<br>            &#125;<br><br>            t= objectMapper.readValue(buffer.toString(),clazz);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> t;<br>    &#125;<br>	<span class="hljs-comment">// 将Result对象转换成JSON串并放入响应对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeJson</span><span class="hljs-params">(HttpServletResponse response, Result result)</span>&#123;<br>        response.setContentType(<span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> objectMapper.writeValueAsString(result);<br>            response.getWriter().write(json);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-6-准备各层的接口和实现类"><a href="#3-6-准备各层的接口和实现类" class="headerlink" title="3.6 准备各层的接口和实现类"></a>3.6 准备各层的接口和实现类</h2><h3 id="3-6-1-准备实体类和VO对象"><a href="#3-6-1-准备实体类和VO对象" class="headerlink" title="3.6.1 准备实体类和VO对象"></a>3.6.1 准备实体类和VO对象</h3><blockquote>
<p>NewsUser</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.pojo;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer uid;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String userPwd;<br>    <span class="hljs-keyword">private</span> String nickName;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>NewsType</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.pojo;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsType</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer tid;<br>    <span class="hljs-keyword">private</span> String tname;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>NewsHeadline</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.pojo;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadline</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer hid;<br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> String article;<br>    <span class="hljs-keyword">private</span> Integer type;<br>    <span class="hljs-keyword">private</span> Integer publisher;<br>    <span class="hljs-keyword">private</span> Integer pageViews;<br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-keyword">private</span> Date updateTime;<br>    <span class="hljs-keyword">private</span> Integer isDeleted;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>HeadlineQueryVo</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.pojo.vo;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeadlineQueryVo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> String keyWords;<br>    <span class="hljs-keyword">private</span> Integer type ;<br>    <span class="hljs-keyword">private</span> Integer pageNum;<br>    <span class="hljs-keyword">private</span> Integer pageSize;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>HeadlinePageVo</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.pojo.vo;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeadlinePageVo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer hid;<br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> Integer type;<br>    <span class="hljs-keyword">private</span> Integer pageViews;<br>    <span class="hljs-keyword">private</span> Long pastHours;<br>    <span class="hljs-keyword">private</span> Integer publisher;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>HeadlineDetailVo</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.pojo.vo;<br><br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeadlineDetailVo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer hid;<br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> String article;<br>    <span class="hljs-keyword">private</span> Integer type;<br>    <span class="hljs-keyword">private</span> String typeName;<br>    <span class="hljs-keyword">private</span> Integer pageViews;<br>    <span class="hljs-keyword">private</span> Long pastHours;<br>    <span class="hljs-keyword">private</span> Integer publisher;<br>    <span class="hljs-keyword">private</span> String author;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="3-6-2-DAO层接口和实现类"><a href="#3-6-2-DAO层接口和实现类" class="headerlink" title="3.6.2 DAO层接口和实现类"></a>3.6.2 DAO层接口和实现类</h3><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511850.png" srcset="/img/loading.gif" lazyload alt="1683354561889"></p>
<blockquote>
<p>BaseDao基础类,封装了公共的查询方法和公共的增删改方法</p>
</blockquote>
<ul>
<li><code>注意,所有的Dao接口的实现类都要继承BaseDao</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><br><br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JDBCUtil;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.sql.*;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseDao</span> &#123;<br>    <span class="hljs-comment">// 公共的查询方法  返回的是单个对象</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">baseQueryObject</span><span class="hljs-params">(Class&lt;T&gt; clazz, String sql, Object ... args)</span> &#123;<br>        <span class="hljs-type">T</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> JDBCUtil.getConnection();<br>        <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">preparedStatement</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 准备语句对象</span><br>            preparedStatement = connection.prepareStatement(sql);<br>            <span class="hljs-comment">// 设置语句上的参数</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>                preparedStatement.setObject(i + <span class="hljs-number">1</span>, args[i]);<br>            &#125;<br><br>            <span class="hljs-comment">// 执行 查询</span><br>            resultSet = preparedStatement.executeQuery();<br>            <span class="hljs-keyword">if</span> (resultSet.next()) &#123;<br>                t = (T) resultSet.getObject(<span class="hljs-number">1</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != resultSet) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    resultSet.close();<br>                &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != preparedStatement) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    preparedStatement.close();<br>                &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br><br>            &#125;<br>            JDBCUtil.releaseConnection();<br>        &#125;<br>        <span class="hljs-keyword">return</span> t;<br>    &#125;<br>    <span class="hljs-comment">// 公共的查询方法  返回的是对象的集合</span><br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; List&lt;T&gt; <span class="hljs-title function_">baseQuery</span><span class="hljs-params">(Class clazz, String sql, Object ... args)</span>&#123;<br>        List&lt;T&gt; list =<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> JDBCUtil.getConnection();<br>        PreparedStatement preparedStatement=<span class="hljs-literal">null</span>;<br>        <span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span><span class="hljs-literal">null</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 准备语句对象</span><br>            preparedStatement = connection.prepareStatement(sql);<br>            <span class="hljs-comment">// 设置语句上的参数</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>                preparedStatement.setObject(i+<span class="hljs-number">1</span>,args[i]);<br>            &#125;<br><br>            <span class="hljs-comment">// 执行 查询</span><br>            resultSet = preparedStatement.executeQuery();<br><br>            <span class="hljs-type">ResultSetMetaData</span> <span class="hljs-variable">metaData</span> <span class="hljs-operator">=</span> resultSet.getMetaData();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">columnCount</span> <span class="hljs-operator">=</span> metaData.getColumnCount();<br><br>            <span class="hljs-comment">// 将结果集通过反射封装成实体类对象</span><br>            <span class="hljs-keyword">while</span> (resultSet.next()) &#123;<br>                <span class="hljs-comment">// 使用反射实例化对象</span><br>                <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span>clazz.getDeclaredConstructor().newInstance();<br><br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= columnCount; i++) &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">columnName</span> <span class="hljs-operator">=</span> metaData.getColumnLabel(i);<br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> resultSet.getObject(columnName);<br>                    <span class="hljs-comment">// 处理datetime类型字段和java.util.Data转换问题</span><br>                    <span class="hljs-keyword">if</span>(value.getClass().equals(LocalDateTime.class))&#123;<br>                        value= Timestamp.valueOf((LocalDateTime) value);<br>                    &#125;<br>                    <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> clazz.getDeclaredField(columnName);<br>                    field.setAccessible(<span class="hljs-literal">true</span>);<br>                    field.set(obj,value);<br>                &#125;<br><br>                list.add((T)obj);<br>            &#125;<br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> !=resultSet) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    resultSet.close();<br>                &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != preparedStatement) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    preparedStatement.close();<br>                &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br>            &#125;<br>            JDBCUtil.releaseConnection();<br>        &#125;<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br>    <br>    <span class="hljs-comment">// 通用的增删改方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">baseUpdate</span><span class="hljs-params">(String sql,Object ... args)</span> &#123;<br>        <span class="hljs-comment">// 获取连接</span><br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> JDBCUtil.getConnection();<br>        PreparedStatement preparedStatement=<span class="hljs-literal">null</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 准备语句对象</span><br>            preparedStatement = connection.prepareStatement(sql);<br>            <span class="hljs-comment">// 设置语句上的参数</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>                preparedStatement.setObject(i+<span class="hljs-number">1</span>,args[i]);<br>            &#125;<br><br>            <span class="hljs-comment">// 执行 增删改 executeUpdate</span><br>            rows = preparedStatement.executeUpdate();<br>            <span class="hljs-comment">// 释放资源(可选)</span><br><br><br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != preparedStatement) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    preparedStatement.close();<br>                &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br><br>            &#125;<br>            JDBCUtil.releaseConnection();<br>        &#125;<br>        <span class="hljs-comment">// 返回的是影响数据库记录数</span><br>        <span class="hljs-keyword">return</span> rows;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>dao层的所有接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadLineDao</span> &#123;<br>    <br>&#125;<br><br><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsTypeDao</span> &#123;<br>    <br>&#125;<br><br><br><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsUserDao</span> &#123;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>dao层所有实现类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadLineDao</span>&#123;<br>    <br>&#125;<br><br><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsTypeDao;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsTypeDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsTypeDao</span>&#123;<br>    <br>&#125;<br><br><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsUserDao;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsUserDao</span>&#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-6-3-Service层接口和实现类"><a href="#3-6-3-Service层接口和实现类" class="headerlink" title="3.6.3 Service层接口和实现类"></a>3.6.3 Service层接口和实现类</h3><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511054.png" srcset="/img/loading.gif" lazyload alt="1683354989263"></p>
<blockquote>
<p>service层所有接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <br>&#125;<br><br><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsTypeService</span> &#123;<br>    List&lt;NewsType&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsUserService</span> &#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>service层所有实现类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>&#125;<br><br><br><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsTypeService;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsTypeServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsTypeService</span> &#123;<br>  <br>&#125;<br><br><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsUserService;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsUserService</span> &#123;<br>   <br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="3-6-4-Controller层接口和实现类"><a href="#3-6-4-Controller层接口和实现类" class="headerlink" title="3.6.4 Controller层接口和实现类"></a>3.6.4 Controller层接口和实现类</h3><blockquote>
<p>BaseController 用于将路径关联到处理方法的基础控制器</p>
</blockquote>
<ul>
<li><code>所有的Controller都要继承该类</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-comment">// 响应的MIME类型和乱码问题</span><br>        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestURI</span> <span class="hljs-operator">=</span> req.getRequestURI();<br>        String[] split = requestURI.split(<span class="hljs-string">&quot;/&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span>split[split.length-<span class="hljs-number">1</span>];<br>        <span class="hljs-comment">// 通过反射获取要执行的方法</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getClass();<br>        <span class="hljs-keyword">try</span> &#123;<br>            Method method=clazz.getDeclaredMethod(methodName,HttpServletRequest.class,HttpServletResponse.class);<br>            <span class="hljs-comment">// 设置方法可以访问</span><br>            method.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-comment">// 通过反射执行代码</span><br>            method.invoke(<span class="hljs-built_in">this</span>,req,resp);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e.getMessage());<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>所有的Controller类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-meta">@WebServlet(&quot;/headline/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span> &#123;<br>    <br>&#125;<br><br><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-meta">@WebServlet(&quot;/type/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsTypeController</span> &#123;<br>    <br>&#125;<br><br><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-meta">@WebServlet(&quot;/user/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span>&#123;<br>    <br>&#125;<br><br><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-meta">@WebServlet(&quot;/portal/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PortalController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span>&#123;<br>    <br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="3-7-开发跨域CORS过滤器"><a href="#3-7-开发跨域CORS过滤器" class="headerlink" title="3.7 开发跨域CORS过滤器"></a>3.7 开发跨域CORS过滤器</h2><h3 id="3-7-1-什么是跨域"><a href="#3-7-1-什么是跨域" class="headerlink" title="3.7.1 什么是跨域"></a>3.7.1 什么是跨域</h3><blockquote>
<p>同源策略（Sameoriginpolicy）是浏览器最核心也最基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。可以说Web是构建在同源策略基础之上的，浏览器只是针对同源策略的一种实现。**<code>同源策略会阻止一个域的javascript脚本和另外一个域的内容进行交互。所谓同源（即指在同一个域）就是两个页面具有相同的协议（protocol），主机（host）和端口号</code>**</p>
</blockquote>
<h3 id="3-7-2-为什么会产生跨域"><a href="#3-7-2-为什么会产生跨域" class="headerlink" title="3.7.2 为什么会产生跨域"></a>3.7.2 为什么会产生跨域</h3><blockquote>
<p>前后端分离模式下,客户端请求前端服务器获取视图资源,然后客户端自行向后端服务器获取数据资源,前端服务器的 协议,IP和端口和后端服务器很可能是不一样的,这样就产生了跨域</p>
</blockquote>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511223.png" srcset="/img/loading.gif" lazyload alt="1683364198087"></p>
<h3 id="3-7-3-如何解决跨域"><a href="#3-7-3-如何解决跨域" class="headerlink" title="3.7.3 如何解决跨域"></a>3.7.3 如何解决跨域</h3><blockquote>
<p>前端项目代理模式处理</p>
</blockquote>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511770.png" srcset="/img/loading.gif" lazyload alt="1683365066926"></p>
<blockquote>
<p>后端跨域过滤器方式处理</p>
</blockquote>
<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511377.png" srcset="/img/loading.gif" lazyload alt="1683364436315"></p>
<ul>
<li>CrosFilter过滤器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.filters;<br><br><span class="hljs-keyword">import</span> jakarta.servlet.*;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebFilter;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-meta">@WebFilter(&quot;/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CrosFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> (HttpServletResponse) servletResponse;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span>(HttpServletRequest) servletRequest;<br>        response.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>);<br>        response.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="hljs-string">&quot;POST, GET, OPTIONS, DELETE, HEAD&quot;</span>);<br>        response.setHeader(<span class="hljs-string">&quot;Access-Control-Max-Age&quot;</span>, <span class="hljs-string">&quot;3600&quot;</span>);<br>        response.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="hljs-string">&quot;access-control-allow-origin, authority, content-type, version-info, X-Requested-With&quot;</span>);<br>        <span class="hljs-comment">// 非预检请求,放行即可,预检请求,则到此结束,不需要放行</span><br>        <span class="hljs-keyword">if</span>(!request.getMethod().equalsIgnoreCase(<span class="hljs-string">&quot;OPTIONS&quot;</span>))&#123;<br>            filterChain.doFilter(servletRequest, servletResponse);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<ul>
<li>未来我们使用框架,直接用一个@CrossOrigin 就可以解决跨域问题了</li>
</ul>
<h1 id="四-PostMan测试工具"><a href="#四-PostMan测试工具" class="headerlink" title="四 PostMan测试工具"></a>四 PostMan测试工具</h1><h2 id="4-1-什么是PostMan"><a href="#4-1-什么是PostMan" class="headerlink" title="4.1 什么是PostMan"></a>4.1 什么是PostMan</h2><ul>
<li>Postman是一个**<code>接口测试工具</code>**,在做接口测试的时候,Postman相当于一个客户端,它可以模拟用户发起的各类HTTP请求,将请求数据发送至服务端,获取对应的响应结果, 从而验证响应中的结果数据是否和预期值相匹配;并确保开发人员能够及时处理接口中的bug,进而保证产品上线之后的稳定性和安全性。 它主要是用来模拟各种HTTP请求的(如:get&#x2F;post&#x2F;delete&#x2F;put..等等),Postman与浏览器的区别在于有的浏览器不能输出Json格式,而Postman更直观接口返回的结果。</li>
</ul>
<h2 id="4-2-怎么安装PostMan"><a href="#4-2-怎么安装PostMan" class="headerlink" title="4.2 怎么安装PostMan"></a>4.2 怎么安装PostMan</h2><ul>
<li>官网下载地址: <a target="_blank" rel="noopener" href="https://www.getpostman.com/">https://www.getpostman.com</a> ,或者使用资料中提供的安装包</li>
<li>安装过程简单,一路next即可</li>
<li>第一次启动postman 会要求输入用户名和密码，如果没有的话，关闭，再次启动就可以直接进入了</li>
</ul>
<h2 id="4-3-怎么使用PostMan"><a href="#4-3-怎么使用PostMan" class="headerlink" title="4.3 怎么使用PostMan"></a>4.3 怎么使用PostMan</h2><blockquote>
<p>启动PostMan后,创建一个collection,在该collection下专门存放和微头条项目相关的测试</p>
</blockquote>
<img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511607.png" srcset="/img/loading.gif" lazyload alt="1683385255826" style="zoom: 65%;" />

<blockquote>
<p>创建完毕后,增加新的接口测试</p>
</blockquote>
<img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511678.png" srcset="/img/loading.gif" lazyload alt="1683385333460" style="zoom:50%;" />

<blockquote>
<p>填写要测试的接口相关的路径,参数,请求体内容等信息</p>
</blockquote>
<img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512824.png" srcset="/img/loading.gif" lazyload alt="1683385500897" style="zoom:55%;" />

<blockquote>
<p>测试完毕后,可以选择将该接口的测试进行保存,方便后续随时再次测试</p>
</blockquote>
<img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512896.png" srcset="/img/loading.gif" lazyload alt="1683385608824" style="zoom:55%;" />





<h1 id="五-登录注册功能"><a href="#五-登录注册功能" class="headerlink" title="五 登录注册功能"></a>五 登录注册功能</h1><h2 id="5-1-登录表单提交"><a href="#5-1-登录表单提交" class="headerlink" title="5.1 登录表单提交"></a>5.1 登录表单提交</h2><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512280.png" srcset="/img/loading.gif" lazyload alt="1687657661761"></p>
<blockquote>
<p>需求描述</p>
</blockquote>
<ul>
<li>用户在客户端输入用户名密码并向后端提交,后端根据用户名和密码判断登录是否成功,用户有误或者密码有误响应不同的提示信息</li>
</ul>
<blockquote>
<p>uri: </p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">user/login<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式:</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;zhangsan&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">//用户名</span><br>    <span class="hljs-attr">&quot;userPwd&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;123456&quot;</span>     <span class="hljs-comment">//明文密码</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<ul>
<li>登录成功</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span>         <span class="hljs-comment">// 成功状态码 </span><br> 	<span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success&quot;</span>   <span class="hljs-comment">// 成功状态描述</span><br> 	<span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>		<span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;... ...&quot;</span> <span class="hljs-comment">// 用户id的token</span><br>	<span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>用户名有误</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;501&quot;</span><span class="hljs-punctuation">,</span><br> 	<span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;用户名有误&quot;</span><br> 	<span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>密码有误</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;503&quot;</span><span class="hljs-punctuation">,</span><br> 	<span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;密码有误&quot;</span><br> 	<span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>NewsUserController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.common.ResultCodeEnum;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsUserService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsUserServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JwtHelper;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.MD5Util;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><br><span class="hljs-meta">@WebServlet(&quot;/user/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsUserService</span> <span class="hljs-variable">newsUserService</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsUserServiceImpl</span>();<br>     <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 登录验证</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">login</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">NewsUser</span> <span class="hljs-variable">newsUser</span> <span class="hljs-operator">=</span> WebUtil.readJson(req, NewsUser.class);<br><br>        <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span><span class="hljs-literal">null</span>;<br>        <span class="hljs-type">NewsUser</span> <span class="hljs-variable">loginNewsUser</span> <span class="hljs-operator">=</span>newsUserService.findByUserName(newsUser.getUsername());<br>        <span class="hljs-comment">// 判断用户名</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != loginNewsUser) &#123;<br>            <span class="hljs-comment">// 判断密码</span><br>            <span class="hljs-keyword">if</span>(loginNewsUser.getUserPwd().equals(MD5Util.encrypt(newsUser.getUserPwd())))&#123;<br>                <span class="hljs-comment">// 密码正确</span><br>                Map&lt;String,Object&gt; data =<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>                <span class="hljs-comment">// 生成token口令</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JwtHelper.createToken(loginNewsUser.getUid().longValue());<br>                <span class="hljs-comment">// 封装数据map</span><br>                data.put(<span class="hljs-string">&quot;token&quot;</span>,token);<br>                <span class="hljs-comment">// 封装结果</span><br>                result=Result.ok(data);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">// 封装密码错误结果</span><br>                result=Result.build(<span class="hljs-literal">null</span>, ResultCodeEnum.PASSWORD_ERROR);<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">// 封装用户名错误结果</span><br>            result=Result.build(<span class="hljs-literal">null</span>, ResultCodeEnum.USERNAME_ERROR);<br>        &#125;<br>        <span class="hljs-comment">// 响应结果</span><br>        WebUtil.writeJson(resp,result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsUserService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsUserService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据用户名,获得查询用户的方法</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username 要查询的用户名</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 如果找到返回NewsUser对象,找不到返回null</span><br><span class="hljs-comment">     */</span><br>    NewsUser <span class="hljs-title function_">findByUserName</span><span class="hljs-params">(String username)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsUserServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsUserDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.impl.NewsUserDaoImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsTypeService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsUserService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.MD5Util;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsUserService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsUserDao</span> <span class="hljs-variable">newsUserDao</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsUserDaoImpl</span>();<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> NewsUser <span class="hljs-title function_">findByUserName</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-keyword">return</span> newsUserDao.findByUserName(username);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewUserDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsUserDao</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据用户名查询用户信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username 要查询的用户名</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 找到返回NewsUser对象,找不到返回null</span><br><span class="hljs-comment">     */</span><br>    NewsUser <span class="hljs-title function_">findByUserName</span><span class="hljs-params">(String username)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsUserDaoImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsUserDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsUserDao</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> NewsUser <span class="hljs-title function_">findByUserName</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-comment">// 准备SQL</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;select uid,username,user_pwd userPwd ,nick_name nickName from news_user where username = ?&quot;</span>;<br>        <span class="hljs-comment">// 调用BaseDao公共查询方法</span><br>        List&lt;NewsUser&gt; newsUserList = baseQuery(NewsUser.class, sql, username);<br>        <span class="hljs-comment">// 如果找到,返回集合中的第一个数据(其实就一个)</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != newsUserList &amp;&amp; newsUserList.size()&gt;<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span>  newsUserList.get(<span class="hljs-number">0</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-2-根据token获取完整用户信息"><a href="#5-2-根据token获取完整用户信息" class="headerlink" title="5.2 根据token获取完整用户信息"></a>5.2 根据token获取完整用户信息</h2><blockquote>
<p>需求描述</p>
</blockquote>
<ul>
<li>客户端发送请求,提交token请求头,后端根据token请求头获取登录用户的详细信息并响应给客户端进行存储</li>
</ul>
<blockquote>
<p>uri</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">user/getUserInfo<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">GET<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求头</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">token<span class="hljs-punctuation">:</span> ... ...<br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<ul>
<li>成功获取</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;loginUser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;uid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;zhangsan&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;userPwd&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;nickName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;张三&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>获取失败</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">504</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;notLogin&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>NewsUserController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.common.ResultCodeEnum;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsUserService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsUserServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JwtHelper;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.MD5Util;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><br><span class="hljs-meta">@WebServlet(&quot;/user/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsUserService</span> <span class="hljs-variable">newsUserService</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsUserServiceImpl</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 接收token,根据token查询完整用户信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> req.getHeader(<span class="hljs-string">&quot;token&quot;</span>);<br>        <span class="hljs-type">Result</span>  <span class="hljs-variable">result</span> <span class="hljs-operator">=</span>Result.build(<span class="hljs-literal">null</span>,ResultCodeEnum.NOTLOGIN);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span>!= token)&#123;<br>            <span class="hljs-keyword">if</span> (!JwtHelper.isExpiration(token)) &#123;<br>                <span class="hljs-type">Integer</span> <span class="hljs-variable">uid</span> <span class="hljs-operator">=</span> JwtHelper.getUserId(token).intValue();<br>                <span class="hljs-type">NewsUser</span> <span class="hljs-variable">newsUser</span> <span class="hljs-operator">=</span>newsUserService.findByUid(uid);<br>                newsUser.setUserPwd(<span class="hljs-string">&quot;&quot;</span>);<br>                Map&lt;String,Object&gt; data =<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>                data.put(<span class="hljs-string">&quot;loginUser&quot;</span>,newsUser);<br>                result=Result.ok(data);<br><br>            &#125;<br>        &#125;<br>        WebUtil.writeJson(resp,result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsUserService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsUserService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据用户id查询用户信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> uid 要查询的用户id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 找到返回NewsUser对象,找不到返回null</span><br><span class="hljs-comment">     */</span><br>    NewsUser <span class="hljs-title function_">findByUid</span><span class="hljs-params">(Integer uid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsUserServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsUserDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.impl.NewsUserDaoImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsTypeService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsUserService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.MD5Util;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsUserService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsUserDao</span> <span class="hljs-variable">newsUserDao</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsUserDaoImpl</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> NewsUser <span class="hljs-title function_">findByUid</span><span class="hljs-params">(Integer uid)</span> &#123;<br>        <span class="hljs-keyword">return</span> newsUserDao.findByUid(uid);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewUserDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsUserDao</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据用户id连接数据库查询用户信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> uid  要查询的用户id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 找到返回NewsUser对象,找不到返回null</span><br><span class="hljs-comment">     */</span><br>    NewsUser <span class="hljs-title function_">findByUid</span><span class="hljs-params">(Integer uid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewUserDaoImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsUserDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsUserDao</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> NewsUser <span class="hljs-title function_">findByUid</span><span class="hljs-params">(Integer uid)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;select uid,username,user_pwd userPwd ,nick_name nickName from news_user where uid = ?&quot;</span>;<br>        List&lt;NewsUser&gt; newsUserList = baseQuery(NewsUser.class, sql, uid);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != newsUserList &amp;&amp; newsUserList.size()&gt;<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span>  newsUserList.get(<span class="hljs-number">0</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-3-注册时用户名占用校验"><a href="#5-3-注册时用户名占用校验" class="headerlink" title="5.3 注册时用户名占用校验"></a>5.3 注册时用户名占用校验</h2><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512364.gif" srcset="/img/loading.gif" lazyload alt="checkuserName" style="zoom:60%;" />

<blockquote>
<p>需求说明</p>
</blockquote>
<ul>
<li>用户在注册时输入用户名时,立刻将用户名发送给后端,后端根据用户名查询用户名是否可用并做出响应</li>
</ul>
<blockquote>
<p>uri:</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">user/checkUserName<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式:</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">username=zhangsan<br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<ul>
<li>用户名校验通过</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span><br> 	<span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success&quot;</span><br> 	<span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>用户名占用</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;505&quot;</span><span class="hljs-punctuation">,</span><br> 	<span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;用户名占用&quot;</span><br> 	<span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>NewsUserController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.common.ResultCodeEnum;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsUserService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsUserServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JwtHelper;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.MD5Util;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><br><span class="hljs-meta">@WebServlet(&quot;/user/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsUserService</span> <span class="hljs-variable">newsUserService</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsUserServiceImpl</span>();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 注册时校验用户名是否被占用</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkUserName</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;username&quot;</span>);<br>        <span class="hljs-type">NewsUser</span> <span class="hljs-variable">newsUser</span> <span class="hljs-operator">=</span> newsUserService.findByUserName(username);<br>        Result result=<span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == newsUser)&#123;<br>            result=Result.ok(<span class="hljs-literal">null</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            result=Result.build(<span class="hljs-literal">null</span>,ResultCodeEnum.USERNAME_USED);<br>        &#125;<br>        WebUtil.writeJson(resp,result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-4-注册表单提交"><a href="#5-4-注册表单提交" class="headerlink" title="5.4 注册表单提交"></a>5.4 注册表单提交</h2><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512575.gif" srcset="/img/loading.gif" lazyload alt="regist" style="zoom:60%;" />

<blockquote>
<p>需求说明</p>
</blockquote>
<ul>
<li>客户端将新用户信息发送给服务端,服务端将新用户存入数据库,存入之前做用户名是否被占用校验,校验通过响应成功提示,否则响应失败提示</li>
</ul>
<blockquote>
<p>uri:</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">user/regist<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式:</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;zhangsan&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;userPwd&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;123456&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;nickName&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;张三&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<ul>
<li>注册成功</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span><br> 	<span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success&quot;</span><br> 	<span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>用户名占用</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;505&quot;</span><span class="hljs-punctuation">,</span><br> 	<span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;用户名占用&quot;</span><br> 	<span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>NewsUserController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.common.ResultCodeEnum;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsUserService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsUserServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JwtHelper;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.MD5Util;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><br><span class="hljs-meta">@WebServlet(&quot;/user/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsUserService</span> <span class="hljs-variable">newsUserService</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsUserServiceImpl</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 注册功能接口</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">regist</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">NewsUser</span> <span class="hljs-variable">newsUser</span> <span class="hljs-operator">=</span> WebUtil.readJson(req, NewsUser.class);<br>        <span class="hljs-type">NewsUser</span> <span class="hljs-variable">usedUser</span> <span class="hljs-operator">=</span> newsUserService.findByUserName(newsUser.getUsername());<br>        Result result=<span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == usedUser)&#123;<br>            newsUserService.registUser(newsUser);<br>            result=Result.ok(<span class="hljs-literal">null</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            result=Result.build(<span class="hljs-literal">null</span>,ResultCodeEnum.USERNAME_USED);<br>        &#125;<br>        WebUtil.writeJson(resp,result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsUserService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsUserService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 注册用户信息,注册成功返回大于0的整数,失败返回0</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> newsUser</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">registUser</span><span class="hljs-params">(NewsUser newsUser)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsUserServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsUserDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.impl.NewsUserDaoImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsTypeService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsUserService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.MD5Util;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsUserService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">registUser</span><span class="hljs-params">(NewsUser newsUser)</span> &#123;<br>        <span class="hljs-comment">// 密码明文转密文</span><br>        newsUser.setUserPwd(MD5Util.encrypt(newsUser.getUserPwd()));<br>        <span class="hljs-comment">// 存入数据库</span><br>        <span class="hljs-keyword">return</span> newsUserDao.insertNewsUser(newsUser);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewUserDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsUserDao</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将用户信息存入数据库</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> newsUser </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">insertNewsUser</span><span class="hljs-params">(NewsUser newsUser)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewUserDaoImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsUserDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsUserDao</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">insertNewsUser</span><span class="hljs-params">(NewsUser newsUser)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;insert into news_user values(DEFAULT,?,?,?)&quot;</span>;<br>        <span class="hljs-keyword">return</span> baseUpdate(sql,newsUser.getUsername(),newsUser.getUserPwd(),newsUser.getNickName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="六-头条首页功能"><a href="#六-头条首页功能" class="headerlink" title="六 头条首页功能"></a>六 头条首页功能</h1><h2 id="6-1-查询所有头条分类"><a href="#6-1-查询所有头条分类" class="headerlink" title="6.1 查询所有头条分类"></a>6.1 查询所有头条分类</h2><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512784.png" srcset="/img/loading.gif" lazyload alt="1684890693363"></p>
<blockquote>
<p>需求说明</p>
</blockquote>
<ul>
<li>进入新闻首页,查询所有分类并动态展示新闻类别栏位</li>
</ul>
<blockquote>
<p>uri:</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">portal/findAllTypes<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">GET<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JSON">无<br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span><br> 	<span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;OK&quot;</span><br> 	<span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-punctuation">[</span><br>                <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;tid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;tname&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;新闻&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;tid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;2&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;tname&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;体育&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;tid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;3&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;tname&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;娱乐&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;tid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;4&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;tname&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;科技&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;tid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;5&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;tname&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;其他&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">]</span><br>    <br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>PortalController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsType;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsTypeService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsTypeServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@WebServlet(&quot;/portal/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PortalController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span>&#123;<br><br>    <span class="hljs-keyword">private</span> NewsHeadlineService headlineService=<span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>();<br>    <span class="hljs-keyword">private</span> NewsTypeService newsTypeService=<span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsTypeServiceImpl</span>();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询所有新闻类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findAllTypes</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        List&lt;NewsType&gt; newsTypeList =newsTypeService.findAll();<br>        WebUtil.writeJson(resp,Result.ok(newsTypeList));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsTypeService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsType;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsTypeService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询全部新闻类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;NewsType&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ul>
<li>NewsTypeServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsTypeDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.impl.NewsTypeDaoImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsType;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsTypeService;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsTypeServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsTypeService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsTypeDao</span>  <span class="hljs-variable">newsTypeDao</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsTypeDaoImpl</span>();<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;NewsType&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> newsTypeDao.findAll();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewUserDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsType;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsTypeDao</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 从数据库中查询全部新闻类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;NewsType&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ul>
<li>NewsTypeDaoImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsTypeDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsType;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsTypeDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsTypeDao</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;NewsType&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;select tid,tname from news_type&quot;</span>;<br>        <span class="hljs-keyword">return</span>  baseQuery(NewsType.class, sql);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="6-2-分页带条件查询所有头条"><a href="#6-2-分页带条件查询所有头条" class="headerlink" title="6.2 分页带条件查询所有头条"></a>6.2 分页带条件查询所有头条</h2><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512659.png" srcset="/img/loading.gif" lazyload alt="1684890943094"></p>
<blockquote>
<p>需求说明</p>
</blockquote>
<ul>
<li>客户端向服务端发送查询关键字,新闻类别,页码数,页大小</li>
<li>服务端根据条件搜索分页信息,返回含页码数,页大小,总页数,总记录数,当前页数据等信息,并根据时间降序,浏览量降序排序</li>
</ul>
<blockquote>
<p>uri:</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">portal/findNewsPage<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式:</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数:</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;keyWords&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;马斯克&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 搜索标题关键字</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span>           <span class="hljs-comment">// 新闻类型</span><br>    <span class="hljs-attr">&quot;pageNum&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// 页码数</span><br>    <span class="hljs-attr">&quot;pageSize&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;10&quot;</span>     <span class="hljs-comment">// 页大小</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例:</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span><br> 	<span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success&quot;</span><br> 	<span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>    	<span class="hljs-attr">&quot;pageInfo&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>    		<span class="hljs-attr">&quot;pageData&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span>                           <span class="hljs-comment">// 本页的数据</span><br>    			<span class="hljs-punctuation">&#123;</span><br>    				<span class="hljs-attr">&quot;hid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span>                     <span class="hljs-comment">// 新闻id </span><br>    				<span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;尚硅谷宣布 ... ...&quot;</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// 新闻标题</span><br>    				<span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span>                    <span class="hljs-comment">// 新闻所属类别编号</span><br>    				<span class="hljs-attr">&quot;pageViews&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;40&quot;</span><span class="hljs-punctuation">,</span>              <span class="hljs-comment">// 新闻浏览量</span><br>    				<span class="hljs-attr">&quot;pastHours&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;3&quot;</span> <span class="hljs-punctuation">,</span>              <span class="hljs-comment">// 发布时间已过小时数</span><br>    				<span class="hljs-attr">&quot;publisher&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span>                <span class="hljs-comment">// 发布用户ID</span><br>				<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>				<span class="hljs-punctuation">&#123;</span><br>    				<span class="hljs-attr">&quot;hid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span>                     <span class="hljs-comment">// 新闻id </span><br>    				<span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;尚硅谷宣布 ... ...&quot;</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// 新闻标题</span><br>    				<span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span>                    <span class="hljs-comment">// 新闻所属类别编号</span><br>    				<span class="hljs-attr">&quot;pageViews&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;40&quot;</span><span class="hljs-punctuation">,</span>              <span class="hljs-comment">// 新闻浏览量</span><br>    				<span class="hljs-attr">&quot;pastHours&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;3&quot;</span><span class="hljs-punctuation">,</span>              <span class="hljs-comment">// 发布时间已过小时数</span><br>    				<span class="hljs-attr">&quot;publisher&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span>                <span class="hljs-comment">// 发布用户ID</span><br>				<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>				<span class="hljs-punctuation">&#123;</span><br>    				<span class="hljs-attr">&quot;hid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span>                     <span class="hljs-comment">// 新闻id </span><br>    				<span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;尚硅谷宣布 ... ...&quot;</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// 新闻标题</span><br>    				<span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span>                    <span class="hljs-comment">// 新闻所属类别编号</span><br>    				<span class="hljs-attr">&quot;pageViews&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;40&quot;</span><span class="hljs-punctuation">,</span>              <span class="hljs-comment">// 新闻浏览量</span><br>    				<span class="hljs-attr">&quot;pastHours&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;3&quot;</span><span class="hljs-punctuation">,</span>               <span class="hljs-comment">// 发布时间已过小时数</span><br>    				<span class="hljs-attr">&quot;publisher&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span>                <span class="hljs-comment">// 发布用户ID</span><br>				<span class="hljs-punctuation">&#125;</span><br>    		<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;pageNum&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span>    <span class="hljs-comment">//页码数</span><br>			<span class="hljs-attr">&quot;pageSize&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 页大小</span><br>			<span class="hljs-attr">&quot;totalPage&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">20</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 总页数</span><br>			<span class="hljs-attr">&quot;totalSize&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">200</span> <span class="hljs-comment">// 总记录数</span><br>		<span class="hljs-punctuation">&#125;</span><br>	<span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p> 后端代码</p>
</blockquote>
<ul>
<li>PortalController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsType;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsTypeService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsTypeServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@WebServlet(&quot;/portal/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PortalController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span>&#123;<br><br>    <span class="hljs-keyword">private</span> NewsHeadlineService headlineService=<span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>();<br>    <span class="hljs-keyword">private</span> NewsTypeService newsTypeService=<span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsTypeServiceImpl</span>();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 分页带条件查询新闻</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findNewsPage</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">HeadlineQueryVo</span> <span class="hljs-variable">headLineQueryVo</span> <span class="hljs-operator">=</span> WebUtil.readJson(req, HeadlineQueryVo.class);<br>        <span class="hljs-comment">// 查询分页五项数据</span><br>        Map&lt;String,Object&gt; pageInfo =headlineService.findPage(headLineQueryVo);<br>        <span class="hljs-comment">// 将分页五项数据放入PageInfoMap</span><br>        Map&lt;String,Object&gt; pageInfoMap=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        pageInfoMap.put(<span class="hljs-string">&quot;pageInfo&quot;</span>,pageInfo);<br>        <span class="hljs-comment">// 响应JSON</span><br>        WebUtil.writeJson(resp, Result.ok(pageInfoMap));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 分页查询头条新闻方法</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> headLineQueryVo</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    Map&lt;String, Object&gt; <span class="hljs-title function_">findPage</span><span class="hljs-params">(HeadlineQueryVo headLineQueryVo)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsHeadLineDao</span> <span class="hljs-variable">newsHeadLineDao</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">findPage</span><span class="hljs-params">(HeadlineQueryVo headLineQueryVo)</span> &#123;<br>        <span class="hljs-comment">// 准备一个map,用于装分页的五项数据</span><br>        Map&lt;String,Object&gt; pageInfo =<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">// 分页查询本页数据</span><br>        List&lt;HeadlinePageVo&gt;  pageData =newsHeadLineDao.findPageList(headLineQueryVo);<br>        <span class="hljs-comment">// 分页查询满足记录的总数据量</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">totalSize</span> <span class="hljs-operator">=</span> newsHeadLineDao.findPageCount(headLineQueryVo);<br>        <span class="hljs-comment">// 页大小</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span>headLineQueryVo.getPageSize();<br>        <span class="hljs-comment">// 总页码数</span><br>        <span class="hljs-type">int</span> totalPage=totalSize%pageSize == <span class="hljs-number">0</span> ?  totalSize/pageSize  : totalSize/pageSize+<span class="hljs-number">1</span>;<br>        <span class="hljs-comment">// 当前页码数</span><br>        <span class="hljs-type">int</span> pageNum= headLineQueryVo.getPageNum();<br>        pageInfo.put(<span class="hljs-string">&quot;pageData&quot;</span>,pageData);<br>        pageInfo.put(<span class="hljs-string">&quot;pageNum&quot;</span>,pageNum);<br>        pageInfo.put(<span class="hljs-string">&quot;pageSize&quot;</span>,pageSize);<br>        pageInfo.put(<span class="hljs-string">&quot;totalPage&quot;</span>,totalPage);<br>        pageInfo.put(<span class="hljs-string">&quot;totalSize&quot;</span>,totalSize);<br><br><br>        <span class="hljs-keyword">return</span> pageInfo;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadLineDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadLineDao</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据查询条件,查询满足条件的记录数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> headLineQueryVo</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">findPageCount</span><span class="hljs-params">(HeadlineQueryVo headLineQueryVo)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据查询条件,查询当前页数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> headLineQueryVo</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;HeadlinePageVo&gt; <span class="hljs-title function_">findPageList</span><span class="hljs-params">(HeadlineQueryVo headLineQueryVo)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineDaoImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadLineDao</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">findPageCount</span><span class="hljs-params">(HeadlineQueryVo headLineQueryVo)</span> &#123;<br>        <span class="hljs-comment">//  拼接动态 SQL,拼接参数</span><br>        List&lt;Object&gt; args =<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        String  sql=<span class="hljs-string">&quot;select count(1) from news_headline where is_deleted=0 &quot;</span>;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sqlBuffer</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(sql) ;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">keyWords</span> <span class="hljs-operator">=</span> headLineQueryVo.getKeyWords();<br>        <span class="hljs-comment">//判断并动态拼接条件</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != keyWords &amp;&amp; keyWords.length()&gt;<span class="hljs-number">0</span>)&#123;<br>            sqlBuffer.append(<span class="hljs-string">&quot;and title like ? &quot;</span>);<br>            args.add(<span class="hljs-string">&quot;%&quot;</span>+keyWords+<span class="hljs-string">&quot;%&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//  判断并动态拼接条件</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> headLineQueryVo.getType();<br>        <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> != type  &amp;&amp; type != <span class="hljs-number">0</span>)&#123;<br>            sqlBuffer.append(<span class="hljs-string">&quot;and type  =  ? &quot;</span>);<br>            args.add(type);<br>        &#125;<br><br>        <span class="hljs-comment">// 参数转数组</span><br>        Object[] argsArr = args.toArray();<br>        System.out.println(sqlBuffer.toString());<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">totalSize</span> <span class="hljs-operator">=</span> baseQueryObject(Long.class, sqlBuffer.toString(), argsArr);<br>        <span class="hljs-comment">// 返回数据</span><br>        <span class="hljs-keyword">return</span> totalSize.intValue();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;HeadlinePageVo&gt; <span class="hljs-title function_">findPageList</span><span class="hljs-params">(HeadlineQueryVo headLineQueryVo)</span> &#123;<br>        <span class="hljs-comment">//  拼接动态 SQL,拼接参数</span><br>        List&lt;Object&gt; args =<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        String  sql=<span class="hljs-string">&quot;select hid,title,type,page_views pageViews,TIMESTAMPDIFF(HOUR,create_time,NOW()) pastHours,publisher from news_headline where is_deleted=0 &quot;</span>;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sqlBuffer</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(sql) ;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">keyWords</span> <span class="hljs-operator">=</span> headLineQueryVo.getKeyWords();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != keyWords &amp;&amp; keyWords.length()&gt;<span class="hljs-number">0</span>)&#123;<br>            sqlBuffer.append(<span class="hljs-string">&quot;and title like ? &quot;</span>);<br>            args.add(<span class="hljs-string">&quot;%&quot;</span>+keyWords+<span class="hljs-string">&quot;%&quot;</span>);<br>        &#125;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> headLineQueryVo.getType();<br>        <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> != type  &amp;&amp; type != <span class="hljs-number">0</span>)&#123;<br>            sqlBuffer.append(<span class="hljs-string">&quot;and type  =  ? &quot;</span>);<br>            args.add(type);<br>        &#125;<br><br>        sqlBuffer.append(<span class="hljs-string">&quot;order by pastHours , page_views desc &quot;</span>);<br>        sqlBuffer.append(<span class="hljs-string">&quot;limit ? , ?&quot;</span>);<br>        args.add((headLineQueryVo.getPageNum()-<span class="hljs-number">1</span>)*headLineQueryVo.getPageSize());<br>        args.add(headLineQueryVo.getPageSize());<br><br>        <span class="hljs-comment">// 参数转数组</span><br>        Object[] argsArr = args.toArray();<br>        System.out.println(sqlBuffer.toString());<br>        List&lt;HeadlinePageVo&gt; pageData = baseQuery(HeadlinePageVo.class, sqlBuffer.toString(), argsArr);<br><br>        <span class="hljs-keyword">return</span> pageData;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="6-3-查看头条详情"><a href="#6-3-查看头条详情" class="headerlink" title="6.3 查看头条详情"></a>6.3 查看头条详情</h2><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512134.png" srcset="/img/loading.gif" lazyload alt="1684891013180" style="zoom:80%;" />

<p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311512280.png" srcset="/img/loading.gif" lazyload alt="1684891029981"></p>
<blockquote>
<p>需求说明</p>
</blockquote>
<ul>
<li>用户点击”查看全文”时,向服务端发送新闻id</li>
<li>后端根据新闻id查询完整新闻文章信息并返回</li>
<li>后端要同时让新闻的浏览量+1</li>
</ul>
<blockquote>
<p>uri</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">portal/showHeadlineDetail<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">hid=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;headline&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;hid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span>                     <span class="hljs-comment">// 新闻id </span><br>            <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;马斯克宣布 ... ...&quot;</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// 新闻标题</span><br>            <span class="hljs-attr">&quot;article&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;... ...&quot;</span>            <span class="hljs-comment">// 新闻正文</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span>                    <span class="hljs-comment">// 新闻所属类别编号</span><br>            <span class="hljs-attr">&quot;typeName&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;科技&quot;</span><span class="hljs-punctuation">,</span>             <span class="hljs-comment">// 新闻所属类别</span><br>            <span class="hljs-attr">&quot;pageViews&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;40&quot;</span><span class="hljs-punctuation">,</span>              <span class="hljs-comment">// 新闻浏览量</span><br>            <span class="hljs-attr">&quot;pastHours&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;3&quot;</span> <span class="hljs-punctuation">,</span>              <span class="hljs-comment">// 发布时间已过小时数</span><br>            <span class="hljs-attr">&quot;publisher&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span> <span class="hljs-punctuation">,</span>               <span class="hljs-comment">// 发布用户ID</span><br>            <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;张三&quot;</span>                 <span class="hljs-comment">// 新闻作者</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>PortalController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsType;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsTypeService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsTypeServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@WebServlet(&quot;/portal/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PortalController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span>&#123;<br><br>    <span class="hljs-keyword">private</span> NewsHeadlineService headlineService=<span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>();<br>    <span class="hljs-keyword">private</span> NewsTypeService newsTypeService=<span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsTypeServiceImpl</span>();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询单个新闻详情</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showHeadlineDetail</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-comment">// 获取要查询的详情新闻id</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">hid</span> <span class="hljs-operator">=</span>Integer.parseInt(req.getParameter(<span class="hljs-string">&quot;hid&quot;</span>));<br>        <br>        <span class="hljs-comment">// 查询新闻详情vo</span><br>        <span class="hljs-type">HeadlineDetailVo</span> <span class="hljs-variable">headlineDetailVo</span> <span class="hljs-operator">=</span>headlineService.findHeadlineDetail(hid);<br>        <span class="hljs-comment">// 封装data内容</span><br>        Map&lt;String ,Object&gt; data =<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        data.put(<span class="hljs-string">&quot;headline&quot;</span>,headlineDetailVo);<br>        <span class="hljs-comment">// 响应JSON</span><br>        WebUtil.writeJson(resp,Result.ok(data));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据头条id,显示头条详情</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> hid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    HeadlineDetailVo <span class="hljs-title function_">findHeadlineDetail</span><span class="hljs-params">(Integer hid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsHeadLineDao</span> <span class="hljs-variable">newsHeadLineDao</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span>();<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> HeadlineDetailVo <span class="hljs-title function_">findHeadlineDetail</span><span class="hljs-params">(Integer hid)</span> &#123;<br>        <span class="hljs-comment">// 修改新闻信息浏览量+1</span><br>        newsHeadLineDao.increasePageViews(hid);<br>        <span class="hljs-comment">// 查询新闻详情</span><br>        <span class="hljs-keyword">return</span> newsHeadLineDao.findHeadlineDetail(hid);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadLineDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadLineDao</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 多表查询新闻详情</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> hid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    HeadlineDetailVo <span class="hljs-title function_">findHeadlineDetail</span><span class="hljs-params">(Integer hid)</span>;<br>    <br>    <span class="hljs-type">int</span> <span class="hljs-title function_">increasePageViews</span><span class="hljs-params">(Integer hid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineDaoImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadLineDao</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> HeadlineDetailVo <span class="hljs-title function_">findHeadlineDetail</span><span class="hljs-params">(Integer hid)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;select hid,title,article,type, tname typeName ,page_views pageViews,TIMESTAMPDIFF(HOUR,create_time,NOW()) pastHours,publisher,nick_name author from news_headline h left join  news_type t on h.type = t.tid left join news_user u  on h.publisher = u.uid where hid = ?&quot;</span>;<br>        List&lt;HeadlineDetailVo&gt; headlineDetailVoList = baseQuery(HeadlineDetailVo.class, sql, hid);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> != headlineDetailVoList &amp;&amp; headlineDetailVoList.size()&gt;<span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">return</span> headlineDetailVoList.get(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">increasePageViews</span><span class="hljs-params">(Integer hid)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;update news_headline set page_views = page_views +1 where hid =?&quot;</span>;<br>        <span class="hljs-keyword">return</span> baseUpdate(sql,hid);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h1 id="七-头条发布修改和删除"><a href="#七-头条发布修改和删除" class="headerlink" title="七 头条发布修改和删除"></a>七 头条发布修改和删除</h1><h2 id="7-1-登录校验"><a href="#7-1-登录校验" class="headerlink" title="7.1 登录校验"></a>7.1 登录校验</h2><blockquote>
<p>需求说明</p>
</blockquote>
<ul>
<li>客户端在进入发布页前、发布新闻前、进入修改页前、修改前、删除新闻前先向服务端发送请求携带token请求头</li>
<li>后端接收token请求头后,校验用户登录是否过期并做响应</li>
<li>前端根据响应信息提示用户进入登录页还是进入正常业务页面</li>
</ul>
<blockquote>
<p>uri</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">user/checkLogin<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">GET<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">无<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求头</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JSON">token<span class="hljs-punctuation">:</span> ... ...<br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<ul>
<li>登录未过期</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>登录已过期</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;504&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;loginExpired&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>NewsUserController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.common.ResultCodeEnum;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsUser;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsUserService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsUserServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JwtHelper;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.MD5Util;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><br><span class="hljs-meta">@WebServlet(&quot;/user/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsUserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsUserService</span> <span class="hljs-variable">newsUserService</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsUserServiceImpl</span>();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 通过token检验用户登录是否过期</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkLogin</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> req.getHeader(<span class="hljs-string">&quot;token&quot;</span>);<br>        <span class="hljs-type">Result</span>  <span class="hljs-variable">result</span> <span class="hljs-operator">=</span>Result.build(<span class="hljs-literal">null</span>,ResultCodeEnum.NOTLOGIN);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span>!= token)&#123;<br>            <span class="hljs-keyword">if</span> (!JwtHelper.isExpiration(token)) &#123;<br>                result=Result.ok(<span class="hljs-literal">null</span>);<br>            &#125;<br>        &#125;<br>        WebUtil.writeJson(resp,result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>登录校验过滤器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.filters;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.common.ResultCodeEnum;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JwtHelper;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.*;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span>(HttpServletRequest)  servletRequest;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;token&quot;</span>);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span><span class="hljs-literal">false</span>;<br>        <span class="hljs-comment">// token不为空并且没过期</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span>  != token )&#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">expiration</span> <span class="hljs-operator">=</span> JwtHelper.isExpiration(token);<br>            <span class="hljs-keyword">if</span> (!expiration )&#123;<br>               flag=<span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (flag)&#123;<br>            filterChain.doFilter(servletRequest,servletResponse);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            WebUtil.writeJson((HttpServletResponse) servletResponse, Result.build(<span class="hljs-literal">null</span>, ResultCodeEnum.NOTLOGIN));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>web.xml中配置登录校验过滤器</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--登录校验过滤器--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>loginFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>com.atguigu.headline.filters.LoginFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>loginFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/headline/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="7-2-提交发布头条"><a href="#7-2-提交发布头条" class="headerlink" title="7.2 提交发布头条"></a>7.2 提交发布头条</h2><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511926.png" srcset="/img/loading.gif" lazyload alt="1683883660552"></p>
<blockquote>
<p>需求说明</p>
</blockquote>
<ul>
<li>用户在客户端输入发布的新闻信息完毕后</li>
<li>发布前先请求后端的登录校验接口验证登录</li>
<li>登录通过则提交新闻信息</li>
<li>后端将新闻信息存入数据库</li>
</ul>
<blockquote>
<p>uri</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">headline/publish<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求头</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">token<span class="hljs-punctuation">:</span> ... ...<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;尚硅谷宣布 ... ...&quot;</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// 文章标题</span><br>    <span class="hljs-attr">&quot;article&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;... ...&quot;</span><span class="hljs-punctuation">,</span>          <span class="hljs-comment">// 文章内容</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span>                    <span class="hljs-comment">// 文章类别</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<ul>
<li>发布成功</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>失去登录状态发布失败</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;504&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;loginExpired&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>NewsHeadlineController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JwtHelper;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@WebServlet(&quot;/headline/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsHeadlineService</span> <span class="hljs-variable">newsHeadlineService</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 发布新闻</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-comment">// 读取新闻信息</span><br>        <span class="hljs-type">NewsHeadline</span> <span class="hljs-variable">newsHeadline</span> <span class="hljs-operator">=</span> WebUtil.readJson(req, NewsHeadline.class);<br>        <span class="hljs-comment">// 通过token获取发布者ID</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> req.getHeader(<span class="hljs-string">&quot;token&quot;</span>);<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> JwtHelper.getUserId(token);<br>        newsHeadline.setPublisher(userId.intValue());<br>        <span class="hljs-comment">// 将新闻存入数据库</span><br>        newsHeadlineService.addNewsHeadline(newsHeadline);<br>        WebUtil.writeJson(resp,Result.ok(<span class="hljs-literal">null</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 新增头条</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> newsHeadline</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">addNewsHeadline</span><span class="hljs-params">(NewsHeadline newsHeadline)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsHeadLineDao</span> <span class="hljs-variable">newsHeadLineDao</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span>();<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">addNewsHeadline</span><span class="hljs-params">(NewsHeadline newsHeadline)</span> &#123;<br>        <span class="hljs-keyword">return</span> newsHeadLineDao.addNewsHeadline(newsHeadline);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadLineDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadLineDao</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 头条存入数据库</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> newsHeadline</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">addNewsHeadline</span><span class="hljs-params">(NewsHeadline newsHeadline)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineDaoImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadLineDao</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">addNewsHeadline</span><span class="hljs-params">(NewsHeadline newsHeadline)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;insert into news_headline values(DEFAULT,?,?,?,?,0,NOW(),NOW(),0)&quot;</span>;<br><br>        <span class="hljs-keyword">return</span> baseUpdate(<br>                sql,<br>                newsHeadline.getTitle(),<br>                newsHeadline.getArticle(),<br>                newsHeadline.getType(),<br>                newsHeadline.getPublisher()<br>        );<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="7-3-修改头条回显"><a href="#7-3-修改头条回显" class="headerlink" title="7.3 修改头条回显"></a>7.3 修改头条回显</h2><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511966.png" srcset="/img/loading.gif" lazyload alt="1683883695289"></p>
<blockquote>
<p>需求说明</p>
</blockquote>
<ul>
<li>前端先调用登录校验接口,校验登录是否过期</li>
<li>登录校验通过后 ,则根据新闻id查询新闻的完整信息并响应给前端</li>
</ul>
<blockquote>
<p>uri</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">headline/findHeadlineByHid<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">hid=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<ul>
<li>查询成功</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;headline&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;hid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;马斯克宣布&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;article&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;... ... &quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;2&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>NewsHeadlineController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JwtHelper;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@WebServlet(&quot;/headline/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsHeadlineService</span> <span class="hljs-variable">newsHeadlineService</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 修改新闻回显</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findHeadlineByHid</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">hid</span> <span class="hljs-operator">=</span> Integer.parseInt(req.getParameter(<span class="hljs-string">&quot;hid&quot;</span>));<br>        <span class="hljs-type">NewsHeadline</span> <span class="hljs-variable">newsHeadline</span> <span class="hljs-operator">=</span>newsHeadlineService.findHeadlineByHid(hid);<br>        Map&lt;String ,Object&gt; data =<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        data.put(<span class="hljs-string">&quot;headline&quot;</span>,newsHeadline);<br>        WebUtil.writeJson(resp,Result.ok(data));<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据新闻id查询单个新闻</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> hid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    NewsHeadline <span class="hljs-title function_">findHeadlineByHid</span><span class="hljs-params">(Integer hid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsHeadLineDao</span> <span class="hljs-variable">newsHeadLineDao</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span>();<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> NewsHeadline <span class="hljs-title function_">findHeadlineByHid</span><span class="hljs-params">(Integer hid)</span> &#123;<br>        <span class="hljs-keyword">return</span> newsHeadLineDao.findHeadlineByHid(hid);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadLineDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadLineDao</span> &#123;<br>    NewsHeadline <span class="hljs-title function_">findHeadlineByHid</span><span class="hljs-params">(Integer hid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewUserDaoImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadLineDao</span>&#123;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> NewsHeadline <span class="hljs-title function_">findHeadlineByHid</span><span class="hljs-params">(Integer hid)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;select hid,title,article,type,publisher,page_views pageViews from news_headline where hid =?&quot;</span>;<br>        List&lt;NewsHeadline&gt; newsHeadlineList = baseQuery(NewsHeadline.class, sql, hid);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> != newsHeadlineList &amp;&amp; newsHeadlineList.size()&gt;<span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">return</span> newsHeadlineList.get(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="7-4-保存修改"><a href="#7-4-保存修改" class="headerlink" title="7.4 保存修改"></a>7.4 保存修改</h2><blockquote>
<p>需求描述</p>
</blockquote>
<ul>
<li>客户端将新闻信息修改后,提交前先请求登录校验接口校验登录状态</li>
<li>登录校验通过则提交修改后的新闻信息,后端接收并更新进入数据库</li>
</ul>
<blockquote>
<p>uri</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">headline/update<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式 </p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;hid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;尚硅谷宣布 ... ...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;article&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;... ...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;2&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<ul>
<li>修改成功</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>修改失败</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;504&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;loginExpired&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>NewsHeadlineController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JwtHelper;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@WebServlet(&quot;/headline/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsHeadlineService</span> <span class="hljs-variable">newsHeadlineService</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 更新新闻信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">NewsHeadline</span> <span class="hljs-variable">newsHeadline</span> <span class="hljs-operator">=</span> WebUtil.readJson(req, NewsHeadline.class);<br>        newsHeadlineService.updateNewsHeadline(newsHeadline);<br>        WebUtil.writeJson(resp,Result.ok(<span class="hljs-literal">null</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">updateNewsHeadline</span><span class="hljs-params">(NewsHeadline newsHeadline)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsHeadLineDao</span> <span class="hljs-variable">newsHeadLineDao</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span>();<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">updateNewsHeadline</span><span class="hljs-params">(NewsHeadline newsHeadline)</span> &#123;<br>        <span class="hljs-keyword">return</span> newsHeadLineDao.updateNewsHeadline(newsHeadline);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadLineDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadLineDao</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">updateNewsHeadline</span><span class="hljs-params">(NewsHeadline newsHeadline)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewUserDaoImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadLineDao</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">updateNewsHeadline</span><span class="hljs-params">(NewsHeadline newsHeadline)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;update news_headline set title = ?, article= ? , type =? , update_time = NOW() where hid = ? &quot;</span>;<br>        <span class="hljs-keyword">return</span> baseUpdate(<br>                sql,<br>                newsHeadline.getTitle(),<br>                newsHeadline.getArticle(),<br>                newsHeadline.getType(),<br>                newsHeadline.getHid()<br>        );<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="7-5-删除头条"><a href="#7-5-删除头条" class="headerlink" title="7.5 删除头条"></a>7.5 删除头条</h2><p><img src="https://note-1304926383.cos.ap-beijing.myqcloud.com/2024/javaWeb/202408311511884.png" srcset="/img/loading.gif" lazyload alt="1683883724768"></p>
<blockquote>
<p>需求说明</p>
</blockquote>
<ul>
<li>将要删除的新闻id发送给服务端</li>
<li>服务端校验登录是否过期,未过期则直接删除,过期则响应登录过期信息</li>
</ul>
<blockquote>
<p>uri</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">headline/removeByHid<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求方式</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST<br></code></pre></td></tr></table></figure>

<blockquote>
<p>请求参数</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">hid=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>响应示例</p>
</blockquote>
<ul>
<li>删除成功</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;200&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>删除失败</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;504&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;loginExpired&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>    <br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>后端代码</p>
</blockquote>
<ul>
<li>NewsHeadlineController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.controller;<br><br><br><span class="hljs-keyword">import</span> com.atguigu.headline.common.Result;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.JwtHelper;<br><span class="hljs-keyword">import</span> com.atguigu.headline.util.WebUtil;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@WebServlet(&quot;/headline/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsHeadlineService</span> <span class="hljs-variable">newsHeadlineService</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除新闻</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeByHid</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">hid</span> <span class="hljs-operator">=</span> Integer.parseInt(req.getParameter(<span class="hljs-string">&quot;hid&quot;</span>));<br>        newsHeadlineService.removeByHid(hid);<br>        WebUtil.writeJson(resp,Result.ok(<span class="hljs-literal">null</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">removeByHid</span><span class="hljs-params">(Integer hid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.service.NewsHeadlineService;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineServiceImpl</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadlineService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">NewsHeadLineDao</span> <span class="hljs-variable">newsHeadLineDao</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span>();<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">removeByHid</span><span class="hljs-params">(Integer hid)</span> &#123;<br>        <span class="hljs-keyword">return</span> newsHeadLineDao.removeByHid(hid);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadLineDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NewsHeadLineDao</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">removeByHid</span><span class="hljs-params">(Integer hid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>NewsHeadlineDaoImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.headline.dao.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.BaseDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.dao.NewsHeadLineDao;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.NewsHeadline;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineDetailVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlinePageVo;<br><span class="hljs-keyword">import</span> com.atguigu.headline.pojo.vo.HeadlineQueryVo;<br><br><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsHeadlineDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NewsHeadLineDao</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">removeByHid</span><span class="hljs-params">(Integer hid)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;update news_headline set is_deleted =1 ,  update_time =NOW() where hid = ? &quot;</span>;<br>        <span class="hljs-keyword">return</span> baseUpdate(sql,hid);<br>    &#125;<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/java-web/" class="category-chain-item">java web</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/java-web/" class="print-no-link">#java web</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>微头条项目开发</div>
      <div>https://glassless.github.io/2024/08/31/JavaWeb/8.微头条项目开发/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>glasss</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年8月31日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/09/02/ssm/MyBatis/" title="mybatis">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">mybatis</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/08/31/JavaWeb/7.%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" title="前端工程化">
                        <span class="hidden-mobile">前端工程化</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
